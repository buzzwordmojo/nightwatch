"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[891],{3312:(e,t,s)=>{s.d(t,{$:()=>i});var r=s(5155),a=s(2115),n=s(2317),l=s(1027),c=s(1567);let o=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-white hover:bg-success/90",warning:"bg-warning text-black hover:bg-warning/90",danger:"bg-danger text-white hover:bg-danger/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=a.forwardRef((e,t)=>{let{className:s,variant:a,size:l,asChild:i=!1,...d}=e,u=i?n.DX:"button";return(0,r.jsx)(u,{className:(0,c.cn)(o({variant:a,size:l,className:s})),ref:t,...d})});i.displayName="Button"},9749:(e,t,s)=>{s.d(t,{BT:()=>u,Wu:()=>m,ZB:()=>d,Zp:()=>o,aR:()=>i,wL:()=>x});var r=s(5155),a=s(2115),n=s(1027),l=s(1567);let c=(0,n.F)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300",{variants:{variant:{default:"border-border",success:"border-success/50 bg-success/5",warning:"border-warning/50 bg-warning/10 animate-pulse-slow",critical:"border-danger/50 bg-danger/10 animate-pulse-fast shadow-danger/20 shadow-lg"}},defaultVariants:{variant:"default"}}),o=a.forwardRef((e,t)=>{let{className:s,variant:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)(c({variant:a}),s),...n})});o.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});d.displayName="CardTitle";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});u.displayName="CardDescription";let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});m.displayName="CardContent";let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})});x.displayName="CardFooter"},9173:(e,t,s)=>{s.d(t,{k:()=>c});var r=s(5155),a=s(2115),n=s(2263),l=s(1567);let c=a.forwardRef((e,t)=>{let{className:s,value:a,indicatorClassName:c,...o}=e;return(0,r.jsx)(n.bL,{ref:t,className:(0,l.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...o,children:(0,r.jsx)(n.C1,{className:(0,l.cn)("h-full w-full flex-1 bg-primary transition-all",c),style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});c.displayName=n.bL.displayName},4303:(e,t,s)=>{s.d(t,{vk:()=>g,nZ:()=>b,bd:()=>o,yA:()=>m,RQ:()=>k,US:()=>W});var r=s(5155),a=s(2813),n=s(2118),l=s(6152),c=s(1567);function o(e){let{networks:t,selectedSsid:s,onSelect:o,loading:i,error:d,onRetry:u}=e;return i?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(a.A,{className:"h-8 w-8 animate-pulse"}),(0,r.jsx)("div",{className:"absolute inset-0 animate-ping",children:(0,r.jsx)(a.A,{className:"h-8 w-8 opacity-30"})})]}),(0,r.jsx)("p",{className:"mt-4 text-sm",children:"Scanning for networks..."})]}):d?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-8 w-8 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-sm text-destructive",children:d}),u&&(0,r.jsx)("button",{onClick:u,className:"mt-4 text-sm text-primary hover:underline",children:"Try again"})]}):0===t.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-8 w-8"}),(0,r.jsx)("p",{className:"mt-4 text-sm",children:"No networks found"}),u&&(0,r.jsx)("button",{onClick:u,className:"mt-4 text-sm text-primary hover:underline",children:"Scan again"})]}):(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>{var t,i;return(0,r.jsxs)("button",{onClick:()=>o(e.ssid),className:(0,c.cn)("w-full p-4 rounded-lg flex items-center justify-between transition-all","bg-card border border-border hover:border-primary/50 hover:bg-accent/50",s===e.ssid&&"border-primary bg-primary/10 ring-2 ring-primary/20"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(t=e.signal)>=70?(0,r.jsx)(a.A,{className:"h-4 w-4 text-success"}):t>=40?(0,r.jsx)(a.A,{className:"h-4 w-4 text-warning"}):(0,r.jsx)(n.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"font-medium",children:e.ssid}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(i=e.signal)>=70?"Strong":i>=40?"Good":"Weak"," signal"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.security&&"open"!==e.security&&(0,r.jsx)(l.A,{className:"h-3 w-3 text-muted-foreground"}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]},e.ssid)})})}var i=s(2115),d=s(7752),u=s(632);function m(e){let{value:t,onChange:s,placeholder:a="Enter password",disabled:n,error:o,minLength:m=8}=e,[x,f]=(0,i.useState)(!1),h=t.length>=m,p=o||t.length>0&&!h;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:(0,r.jsx)(l.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,r.jsx)("input",{type:x?"text":"password",value:t,onChange:e=>s(e.target.value),placeholder:a,disabled:n,className:(0,c.cn)("w-full pl-10 pr-12 py-3 rounded-lg","bg-card border border-border","text-foreground placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary","disabled:opacity-50 disabled:cursor-not-allowed",p&&"border-destructive focus:ring-destructive/50")}),(0,r.jsx)("button",{type:"button",onClick:()=>f(!x),disabled:n,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground disabled:opacity-50",children:x?(0,r.jsx)(d.A,{className:"h-4 w-4"}):(0,r.jsx)(u.A,{className:"h-4 w-4"})})]}),p&&(0,r.jsx)("p",{className:"text-xs text-destructive",children:o||"Password must be at least ".concat(m," characters")})]})}var x=s(2783),f=s(1342),h=s(654);let p={idle:{icon:(0,r.jsx)(a.A,{className:"h-6 w-6"}),color:"text-muted-foreground",defaultMessage:"Ready to connect"},connecting:{icon:(0,r.jsx)(x.A,{className:"h-6 w-6 animate-spin"}),color:"text-primary",defaultMessage:"Connecting to network..."},searching:{icon:(0,r.jsx)(x.A,{className:"h-6 w-6 animate-spin"}),color:"text-primary",defaultMessage:"Searching for Nightwatch..."},success:{icon:(0,r.jsx)(f.A,{className:"h-6 w-6"}),color:"text-success",defaultMessage:"Connected successfully!"},error:{icon:(0,r.jsx)(h.A,{className:"h-6 w-6"}),color:"text-destructive",defaultMessage:"Connection failed"}};function g(e){let{state:t,message:s,progress:a}=e,n=p[t];return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("div",{className:(0,c.cn)("mb-4",n.color),children:n.icon}),(0,r.jsx)("p",{className:(0,c.cn)("text-sm font-medium",n.color),children:s||n.defaultMessage}),a&&"searching"===t&&(0,r.jsxs)("div",{className:"mt-4 w-full max-w-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[(0,r.jsx)("span",{children:"Scanning network"}),(0,r.jsxs)("span",{children:[Math.round(a.current/a.total*100),"%"]})]}),(0,r.jsx)("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-primary transition-all duration-300",style:{width:"".concat(a.current/a.total*100,"%")}})})]})]})}var w=s(3474),j=s(6240),N=s(9749);function b(e){let{ssid:t,isConnected:s,isChecking:n,attemptCount:l=0}=e;return(0,r.jsxs)(N.Zp,{children:[(0,r.jsx)(N.aR,{className:"pb-4",children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,r.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary text-sm font-bold",children:"1"}),"Connect to Nightwatch"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-1",children:"WiFi Network Name"}),(0,r.jsx)("p",{className:"text-xl font-mono font-bold text-primary",children:t})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(w.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Open your phone's ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:"Settings"})," app"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(a.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Go to ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:"WiFi"})," settings"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(j.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Select ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:t})," and connect"]})]})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-border",children:s?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-success",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-success"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Connected to Nightwatch!"})]}):n?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),(0,r.jsxs)("span",{className:"text-sm",children:["Waiting for connection...",l>1&&" (".concat(l,")")]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-muted"}),(0,r.jsx)("span",{className:"text-sm",children:"Not connected"})]})})]})]})}var v=s(2604),y=s(3312);function k(e){let{dashboardUrl:t,ssid:s}=e;return(0,r.jsxs)(N.Zp,{variant:"success",children:[(0,r.jsx)(N.aR,{className:"pb-4",children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,r.jsx)(f.A,{className:"h-6 w-6 text-success"}),"Nightwatch is Ready!"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-6",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:s?(0,r.jsxs)(r.Fragment,{children:["Your Nightwatch device is now connected to"," ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:s})," and ready to use."]}):(0,r.jsx)(r.Fragment,{children:"Your Nightwatch device is connected and ready to use."})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(y.$,{asChild:!0,className:"w-full",size:"lg",children:(0,r.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:["Open Dashboard",(0,r.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})}),(0,r.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Bookmark the dashboard for quick access"})]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,r.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Next Steps"}),(0,r.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Position sensors in the bedroom"]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Configure alert preferences"]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Set up push notifications (optional)"]})]})]})]})]})}async function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,s=new AbortController,r=setTimeout(()=>s.abort(),t);try{let t=await fetch("".concat(e,"/health"),{mode:"cors",cache:"no-store",signal:s.signal});if(clearTimeout(r),t.ok)return await t.json();return null}catch(e){return clearTimeout(r),null}}async function A(e){try{let t=await fetch("".concat(e,"/api/setup/wifi/scan"),{mode:"cors",cache:"no-store"});if(!t.ok)throw Error("Scan failed: ".concat(t.status));return(await t.json()).networks||[]}catch(e){throw console.error("WiFi scan error:",e),e}}async function S(e,t,s){try{let r=await fetch("".concat(e,"/api/setup/wifi"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({ssid:t,password:s})}),a=await r.json();if(!r.ok||!a.success)throw Error(a.message||"Failed to configure WiFi");return a}catch(e){throw console.error("WiFi config error:",e),e}}let R=["192.168.86","192.168.1","192.168.0","10.0.0","10.0.1"];async function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return await C(e,t)?e:null}async function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return(await Promise.all(e.map(e=>P(e,t)))).find(e=>null!==e)||null}async function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{timeoutMs:t=1e3,batchSize:s=20,onProgress:r,signal:a}=e,n="http://nightwatch.local:".concat(9530);if(await C(n,2e3))return{found:!0,url:n,scanned:0};let l=function(){let e=[];for(let t of R)for(let s=2;s<=100;s++)e.push("http://".concat(t,".").concat(s,":").concat(9530));return e}(),c=0;for(let e=0;e<l.length&&(null==a||!a.aborted);e+=s){let a=l.slice(e,e+s),n=await T(a,t);if(c+=a.length,null==r||r(c,l.length),n)return{found:!0,url:n,scanned:c}}return{found:!1,url:null,scanned:c}}async function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxAttempts:t=30,intervalMs:s=2e3,onAttempt:r,signal:a}=e;for(let e=1;e<=t;e++){if(null==a?void 0:a.aborted)return{found:!1,url:null,scanned:e};null==r||r(e,t);let n=await F({timeoutMs:1500,batchSize:20,signal:a});if(n.found)return n;await new Promise(e=>setTimeout(e,s))}return{found:!1,url:null,scanned:t}}function W(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{portalUrl:t="http://192.168.4.1",autoStart:s=!0,skipHotspotDetection:r=!1,skipDeviceSearch:a=!1}=e,[n,l]=(0,i.useState)({step:r?"select-network":"connect-hotspot",networks:[],selectedSsid:null,password:"",error:null,dashboardUrl:null,hotspotConnected:!1,hotspotAttempts:0,searchProgress:null}),c=(0,i.useRef)(null),o=(0,i.useRef)(null);(0,i.useEffect)(()=>()=>{var e;null===(e=c.current)||void 0===e||e.abort(),o.current&&clearTimeout(o.current)},[]);let d=(0,i.useCallback)(async()=>(l(e=>({...e,hotspotAttempts:e.hotspotAttempts+1})),!!await C(t,2e3)&&(l(e=>({...e,hotspotConnected:!0,step:"select-network"})),!0)),[t]);(0,i.useEffect)(()=>{if(!s||r||"connect-hotspot"!==n.step)return;let e=async()=>{await d()||"connect-hotspot"!==n.step||(o.current=window.setTimeout(e,2e3))};return e(),()=>{o.current&&clearTimeout(o.current)}},[s,r,n.step,d]),(0,i.useEffect)(()=>{"select-network"===n.step&&0===n.networks.length&&x()},[n.step]);let u=(0,i.useCallback)(e=>{l(t=>({...t,selectedSsid:e,step:e?"entering-password":"select-network",password:"",error:null}))},[]),m=(0,i.useCallback)(e=>{l(t=>({...t,password:e,error:null}))},[]),x=(0,i.useCallback)(async()=>{l(e=>({...e,error:null}));try{let e=await A(t);l(t=>({...t,networks:e}))}catch(e){l(t=>({...t,error:e instanceof Error?e.message:"Failed to scan networks"}))}},[t]),f=(0,i.useCallback)(async()=>{let{selectedSsid:e,password:s}=n;if(!e||s.length<8){l(e=>({...e,error:"Please select a network and enter a valid password"}));return}l(e=>({...e,step:"connecting",error:null}));try{if(await S(t,e,s),a){localStorage.setItem("nightwatch_setup_complete","true"),l(e=>({...e,step:"complete",searchProgress:null}));return}l(e=>({...e,step:"searching"})),c.current=new AbortController;let r=await E({maxAttempts:45,intervalMs:2e3,signal:c.current.signal,onAttempt:(e,t)=>{l(s=>({...s,searchProgress:{current:e,total:t}}))}});r.found&&r.url?(localStorage.setItem("nightwatch_setup_complete","true"),l(e=>({...e,step:"complete",dashboardUrl:r.url,searchProgress:null}))):l(e=>({...e,step:"error",error:"Could not find Nightwatch on your network. Please try again.",searchProgress:null}))}catch(e){l(t=>({...t,step:"error",error:e instanceof Error?e.message:"Connection failed",searchProgress:null}))}},[n,t,a]),h=(0,i.useCallback)(()=>{l(e=>({...e,step:"select-network",error:null,password:"",searchProgress:null}))},[]),p=(0,i.useCallback)(()=>{l(e=>{switch(e.step){case"entering-password":return{...e,step:"select-network",selectedSsid:null,password:""};case"error":return{...e,step:"select-network",error:null};default:return e}})},[]);return{...n,setSelectedSsid:u,setPassword:m,scanWifi:x,connect:f,retry:h,goBack:p}}},1567:(e,t,s)=>{s.d(t,{cn:()=>n,fU:()=>l});var r=s(3463),a=s(9795);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}function l(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}}}]);