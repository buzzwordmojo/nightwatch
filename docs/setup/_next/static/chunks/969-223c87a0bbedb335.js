"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{3312:(e,t,s)=>{s.d(t,{$:()=>i});var r=s(5155),n=s(2115),a=s(2317),l=s(1027),c=s(1567);let o=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",success:"bg-success text-white hover:bg-success/90",warning:"bg-warning text-black hover:bg-warning/90",danger:"bg-danger text-white hover:bg-danger/90"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=n.forwardRef((e,t)=>{let{className:s,variant:n,size:l,asChild:i=!1,...d}=e,u=i?a.DX:"button";return(0,r.jsx)(u,{className:(0,c.cn)(o({variant:n,size:l,className:s})),ref:t,...d})});i.displayName="Button"},9749:(e,t,s)=>{s.d(t,{BT:()=>u,Wu:()=>m,ZB:()=>d,Zp:()=>o,aR:()=>i,wL:()=>h});var r=s(5155),n=s(2115),a=s(1027),l=s(1567);let c=(0,a.F)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300",{variants:{variant:{default:"border-border",success:"border-success/50 bg-success/5",warning:"border-warning/50 bg-warning/10 animate-pulse-slow",critical:"border-danger/50 bg-danger/10 animate-pulse-fast shadow-danger/20 shadow-lg"}},defaultVariants:{variant:"default"}}),o=n.forwardRef((e,t)=>{let{className:s,variant:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)(c({variant:n}),s),...a})});o.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...n})});i.displayName="CardHeader";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});d.displayName="CardTitle";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...n})});u.displayName="CardDescription";let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...n})});m.displayName="CardContent";let h=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...n})});h.displayName="CardFooter"},9173:(e,t,s)=>{s.d(t,{k:()=>c});var r=s(5155),n=s(2115),a=s(2263),l=s(1567);let c=n.forwardRef((e,t)=>{let{className:s,value:n,indicatorClassName:c,...o}=e;return(0,r.jsx)(a.bL,{ref:t,className:(0,l.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...o,children:(0,r.jsx)(a.C1,{className:(0,l.cn)("h-full w-full flex-1 bg-primary transition-all",c),style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});c.displayName=a.bL.displayName},9285:(e,t,s)=>{s.d(t,{vk:()=>g,nZ:()=>b,bd:()=>o,yA:()=>m,zb:()=>S,RQ:()=>k,US:()=>I});var r=s(5155),n=s(2813),a=s(2118),l=s(6152),c=s(1567);function o(e){let{networks:t,selectedSsid:s,onSelect:o,loading:i,error:d,onRetry:u}=e;return i?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(n.A,{className:"h-8 w-8 animate-pulse"}),(0,r.jsx)("div",{className:"absolute inset-0 animate-ping",children:(0,r.jsx)(n.A,{className:"h-8 w-8 opacity-30"})})]}),(0,r.jsx)("p",{className:"mt-4 text-sm",children:"Scanning for networks..."})]}):d?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsx)(a.A,{className:"h-8 w-8 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-sm text-destructive",children:d}),u&&(0,r.jsx)("button",{onClick:u,className:"mt-4 text-sm text-primary hover:underline",children:"Try again"})]}):0===t.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,r.jsx)(a.A,{className:"h-8 w-8"}),(0,r.jsx)("p",{className:"mt-4 text-sm",children:"No networks found"}),u&&(0,r.jsx)("button",{onClick:u,className:"mt-4 text-sm text-primary hover:underline",children:"Scan again"})]}):(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>{var t,i;return(0,r.jsxs)("button",{onClick:()=>o(e.ssid),className:(0,c.cn)("w-full p-4 rounded-lg flex items-center justify-between transition-all","bg-card border border-border hover:border-primary/50 hover:bg-accent/50",s===e.ssid&&"border-primary bg-primary/10 ring-2 ring-primary/20"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(t=e.signal)>=70?(0,r.jsx)(n.A,{className:"h-4 w-4 text-success"}):t>=40?(0,r.jsx)(n.A,{className:"h-4 w-4 text-warning"}):(0,r.jsx)(a.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("p",{className:"font-medium",children:e.ssid}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(i=e.signal)>=70?"Strong":i>=40?"Good":"Weak"," signal"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.security&&"open"!==e.security&&(0,r.jsx)(l.A,{className:"h-3 w-3 text-muted-foreground"}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[e.signal,"%"]})]})]},e.ssid)})})}var i=s(2115),d=s(7752),u=s(632);function m(e){let{value:t,onChange:s,placeholder:n="Enter password",disabled:a,error:o,minLength:m=8}=e,[h,x]=(0,i.useState)(!1),f=t.length>=m,p=o||t.length>0&&!f;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:(0,r.jsx)(l.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,r.jsx)("input",{type:h?"text":"password",value:t,onChange:e=>s(e.target.value),placeholder:n,disabled:a,className:(0,c.cn)("w-full pl-10 pr-12 py-3 rounded-lg","bg-card border border-border","text-foreground placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary","disabled:opacity-50 disabled:cursor-not-allowed",p&&"border-destructive focus:ring-destructive/50")}),(0,r.jsx)("button",{type:"button",onClick:()=>x(!h),disabled:a,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground disabled:opacity-50",children:h?(0,r.jsx)(d.A,{className:"h-4 w-4"}):(0,r.jsx)(u.A,{className:"h-4 w-4"})})]}),p&&(0,r.jsx)("p",{className:"text-xs text-destructive",children:o||"Password must be at least ".concat(m," characters")})]})}var h=s(2783),x=s(1342),f=s(654);let p={idle:{icon:(0,r.jsx)(n.A,{className:"h-6 w-6"}),color:"text-muted-foreground",defaultMessage:"Ready to connect"},connecting:{icon:(0,r.jsx)(h.A,{className:"h-6 w-6 animate-spin"}),color:"text-primary",defaultMessage:"Connecting to network..."},searching:{icon:(0,r.jsx)(h.A,{className:"h-6 w-6 animate-spin"}),color:"text-primary",defaultMessage:"Searching for Nightwatch..."},success:{icon:(0,r.jsx)(x.A,{className:"h-6 w-6"}),color:"text-success",defaultMessage:"Connected successfully!"},error:{icon:(0,r.jsx)(f.A,{className:"h-6 w-6"}),color:"text-destructive",defaultMessage:"Connection failed"}};function g(e){let{state:t,message:s,progress:n}=e,a=p[t];return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("div",{className:(0,c.cn)("mb-4",a.color),children:a.icon}),(0,r.jsx)("p",{className:(0,c.cn)("text-sm font-medium",a.color),children:s||a.defaultMessage}),n&&"searching"===t&&(0,r.jsxs)("div",{className:"mt-4 w-full max-w-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[(0,r.jsx)("span",{children:"Scanning network"}),(0,r.jsxs)("span",{children:[Math.round(n.current/n.total*100),"%"]})]}),(0,r.jsx)("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-primary transition-all duration-300",style:{width:"".concat(n.current/n.total*100,"%")}})})]})]})}var w=s(3474),j=s(6240),N=s(9749);function b(e){let{ssid:t,isConnected:s,isChecking:a,attemptCount:l=0}=e;return(0,r.jsxs)(N.Zp,{children:[(0,r.jsx)(N.aR,{className:"pb-4",children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,r.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary text-sm font-bold",children:"1"}),"Connect to Nightwatch"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-1",children:"WiFi Network Name"}),(0,r.jsx)("p",{className:"text-xl font-mono font-bold text-primary",children:t})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(w.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Open your phone's ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:"Settings"})," app"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(n.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Go to ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:"WiFi"})," settings"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-muted flex items-center justify-center",children:(0,r.jsx)(j.A,{className:"h-3 w-3"})}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Select ",(0,r.jsx)("span",{className:"text-foreground font-medium",children:t})," and connect"]})]})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-border",children:s?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-success",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-success"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Connected to Nightwatch!"})]}):a?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),(0,r.jsxs)("span",{className:"text-sm",children:["Waiting for connection...",l>1&&" (".concat(l,")")]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-muted"}),(0,r.jsx)("span",{className:"text-sm",children:"Not connected"})]})})]})]})}var v=s(2604),y=s(3312);function k(e){let{dashboardUrl:t,ssid:s}=e;return(0,r.jsxs)(N.Zp,{variant:"success",children:[(0,r.jsx)(N.aR,{className:"pb-4",children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,r.jsx)(x.A,{className:"h-6 w-6 text-success"}),"Nightwatch is Ready!"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-6",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:s?(0,r.jsxs)(r.Fragment,{children:["Your Nightwatch device is now connected to"," ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:s})," and ready to use."]}):(0,r.jsx)(r.Fragment,{children:"Your Nightwatch device is connected and ready to use."})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(y.$,{asChild:!0,className:"w-full",size:"lg",children:(0,r.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:["Open Dashboard",(0,r.jsx)(v.A,{className:"ml-2 h-4 w-4"})]})}),(0,r.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Bookmark the dashboard for quick access"})]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-border",children:[(0,r.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Next Steps"}),(0,r.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Position sensors in the bedroom"]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Configure alert preferences"]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-primary",children:"•"}),"Set up push notifications (optional)"]})]})]})]})]})}var C=s(4815),A=s(5325);function S(e){let{certUrl:t="https://nightwatch.local",onContinue:s}=e;return(0,r.jsxs)(N.Zp,{children:[(0,r.jsx)(N.aR,{className:"pb-4",children:(0,r.jsxs)(N.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,r.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary text-sm font-bold",children:(0,r.jsx)(C.A,{className:"h-4 w-4"})}),"Trust Security Certificate"]})}),(0,r.jsxs)(N.Wu,{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-muted/50 rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nightwatch uses a self-signed security certificate. You need to trust it once so your phone can find the device on your network."})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"Step 1: Open this link"}),(0,r.jsxs)(y.$,{variant:"outline",className:"w-full justify-between",onClick:()=>{window.open(t,"_blank")},children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(C.A,{className:"h-4 w-4"}),"Open Certificate Page"]}),(0,r.jsx)(v.A,{className:"h-4 w-4"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"Step 2: Accept the certificate"}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2 pl-4 border-l-2 border-muted",children:[(0,r.jsx)("p",{children:"When you see a security warning:"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(A.A,{className:"h-3 w-3"}),(0,r.jsxs)("span",{children:["Tap ",(0,r.jsx)("strong",{children:'"Advanced"'})," or ",(0,r.jsx)("strong",{children:'"Show Details"'})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(A.A,{className:"h-3 w-3"}),(0,r.jsxs)("span",{children:["Tap ",(0,r.jsx)("strong",{children:'"Proceed"'})," or ",(0,r.jsx)("strong",{children:'"Visit Site"'})]})]}),(0,r.jsx)("p",{className:"text-xs pt-1 text-muted-foreground/70",children:"You should see the Nightwatch dashboard. You can close that tab."})]})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-border",children:(0,r.jsx)(y.$,{className:"w-full",size:"lg",onClick:s,children:"I've Accepted — Continue Setup"})})]})]})}async function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,s=new AbortController,r=setTimeout(()=>s.abort(),t);try{let t=await fetch("".concat(e,"/health"),{mode:"cors",cache:"no-store",signal:s.signal});if(clearTimeout(r),t.ok)return await t.json();return null}catch(e){return clearTimeout(r),null}}async function R(e){try{let t=await fetch("".concat(e,"/api/setup/wifi/scan"),{mode:"cors",cache:"no-store"});if(!t.ok)throw Error("Scan failed: ".concat(t.status));return(await t.json()).networks||[]}catch(e){throw console.error("WiFi scan error:",e),e}}async function T(e,t,s){try{let r=await fetch("".concat(e,"/api/setup/wifi"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({ssid:t,password:s})}),n=await r.json();if(!r.ok||!n.success)throw Error(n.message||"Failed to configure WiFi");return n}catch(e){throw console.error("WiFi config error:",e),e}}let F=["192.168.86","192.168.1","192.168.0","10.0.0","10.0.1"];async function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=arguments.length>2?arguments[2]:void 0;try{if(await P(e,t))return null==s||s("✓ Found device at ".concat(e)),e;return null}catch(t){return null==s||s("✗ ".concat(e,": ").concat(t instanceof Error?t.message:"failed")),null}}async function W(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{timeoutMs:t=1e3,batchSize:s=20,onProgress:r,signal:n,onDebug:a}=e,l="https://nightwatch.local";null==a||a("Trying mDNS: ".concat(l));try{if(await P(l,2e3))return null==a||a("✓ Found via mDNS: ".concat(l)),{found:!0,url:l,scanned:0};null==a||a("✗ mDNS failed (no response)")}catch(e){null==a||a("✗ mDNS error: ".concat(e instanceof Error?e.message:"unknown"))}let c=function(){let e=[];for(let t of F)for(let s=2;s<=100;s++)e.push("https://".concat(t,".").concat(s));return e}(),o=0;null==a||a("Starting IP scan (".concat(c.length," IPs, batch size ").concat(s,")"));for(let e=0;e<c.length;e+=s){if(null==n?void 0:n.aborted)return null==a||a("Scan aborted at ".concat(o," IPs")),{found:!1,url:null,scanned:o};let l=c.slice(e,e+s),i=(await Promise.all(l.map(s=>E(s,t,0===e?a:void 0)))).find(e=>null!==e)||null;if(o+=l.length,null==r||r(o,c.length),i)return null==a||a("✓ Found device at ".concat(i)),{found:!0,url:i,scanned:o}}return null==a||a("✗ Scan complete, device not found (scanned ".concat(o," IPs)")),{found:!1,url:null,scanned:o}}async function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxAttempts:t=30,intervalMs:s=2e3,onAttempt:r,signal:n}=e;for(let e=1;e<=t;e++){if(null==n?void 0:n.aborted)return{found:!1,url:null,scanned:e};null==r||r(e,t);let a=await W({timeoutMs:1500,batchSize:20,signal:n});if(a.found)return a;await new Promise(e=>setTimeout(e,s))}return{found:!1,url:null,scanned:t}}function I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{portalUrl:t="http://192.168.4.1",autoStart:s=!0,skipHotspotDetection:r=!1,skipDeviceSearch:n=!1}=e,[a,l]=(0,i.useState)({step:r?"select-network":"connect-hotspot",networks:[],selectedSsid:null,password:"",error:null,dashboardUrl:null,hotspotConnected:!1,hotspotAttempts:0,searchProgress:null,shutdownCountdown:null}),c=(0,i.useRef)(null),o=(0,i.useRef)(null),d=(0,i.useRef)(null);(0,i.useEffect)(()=>()=>{var e;null===(e=c.current)||void 0===e||e.abort(),o.current&&clearTimeout(o.current),d.current&&clearInterval(d.current)},[]);let u=(0,i.useCallback)(async()=>(l(e=>({...e,hotspotAttempts:e.hotspotAttempts+1})),!!await P(t,2e3)&&(l(e=>({...e,hotspotConnected:!0,step:"trust-cert"})),!0)),[t]);(0,i.useEffect)(()=>{if(!s||r||"connect-hotspot"!==a.step)return;let e=async()=>{await u()||"connect-hotspot"!==a.step||(o.current=window.setTimeout(e,2e3))};return e(),()=>{o.current&&clearTimeout(o.current)}},[s,r,a.step,u]),(0,i.useEffect)(()=>{"select-network"===a.step&&0===a.networks.length&&x()},[a.step]);let m=(0,i.useCallback)(e=>{l(t=>({...t,selectedSsid:e,step:e?"entering-password":"select-network",password:"",error:null}))},[]),h=(0,i.useCallback)(e=>{l(t=>({...t,password:e,error:null}))},[]),x=(0,i.useCallback)(async()=>{l(e=>({...e,error:null}));try{let e=await R(t);l(t=>({...t,networks:e}))}catch(e){l(t=>({...t,error:e instanceof Error?e.message:"Failed to scan networks"}))}},[t]),f=(0,i.useCallback)(async()=>{let{selectedSsid:e,password:s}=a;if(!e||s.length<8){l(e=>({...e,error:"Please select a network and enter a valid password"}));return}l(e=>({...e,step:"connecting",error:null}));try{let r=(await T(t,e,s)).hotspot_shutdown_delay||15;if(n){localStorage.setItem("nightwatch_setup_complete","true"),l(e=>({...e,step:"complete",searchProgress:null,shutdownCountdown:r})),d.current=window.setInterval(()=>{l(e=>null!==e.shutdownCountdown&&e.shutdownCountdown>0?{...e,shutdownCountdown:e.shutdownCountdown-1}:(d.current&&clearInterval(d.current),{...e,shutdownCountdown:0}))},1e3);return}l(e=>({...e,step:"searching"})),c.current=new AbortController;let a=await _({maxAttempts:45,intervalMs:2e3,signal:c.current.signal,onAttempt:(e,t)=>{l(s=>({...s,searchProgress:{current:e,total:t}}))}});a.found&&a.url?(localStorage.setItem("nightwatch_setup_complete","true"),l(e=>({...e,step:"complete",dashboardUrl:a.url,searchProgress:null}))):l(e=>({...e,step:"error",error:"Could not find Nightwatch on your network. Please try again.",searchProgress:null}))}catch(e){l(t=>({...t,step:"error",error:e instanceof Error?e.message:"Connection failed",searchProgress:null}))}},[a,t,n]),p=(0,i.useCallback)(()=>{l(e=>({...e,step:"select-network",error:null,password:"",searchProgress:null}))},[]),g=(0,i.useCallback)(()=>{l(e=>{switch(e.step){case"entering-password":return{...e,step:"select-network",selectedSsid:null,password:""};case"error":return{...e,step:"select-network",error:null};default:return e}})},[]),w=(0,i.useCallback)(()=>{l(e=>({...e,step:"select-network"}))},[]);return{...a,setSelectedSsid:m,setPassword:h,scanWifi:x,connect:f,retry:p,goBack:g,proceedAfterCertTrust:w}}},1567:(e,t,s)=>{s.d(t,{cn:()=>a,fU:()=>l});var r=s(3463),n=s(9795);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.QP)((0,r.$)(t))}function l(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}}}]);